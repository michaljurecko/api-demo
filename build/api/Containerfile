# See build/dev/Containerfile
ARG DEV_IMAGE="api-demo-dev:latest"
FROM $DEV_IMAGE AS base
USER root

WORKDIR /code/cmd/demo

RUN --mount=type=bind,source=./,target=/code \
    CGO_ENABLED=0 GOOS=linux GOARCH=amd64 \
    go build -mod=mod -o /tmp/server .

FROM docker.io/debian:12-slim

# Install SSL certificates
RUN apt-get update && apt-get install -y \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

COPY --from=base /tmp/server /usr/local/bin/server

EXPOSE 8000

ENTRYPOINT ["/usr/local/bin/server"]
